<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Level Up</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-bg: #ffffff; --tg-text: #000000; --tg-button: #3390ec;
            --tg-button-text: #ffffff; --tg-hint: #999999;
        }
        body { background-color: var(--tg-bg); color: var(--tg-text); }
        .btn-primary { background-color: var(--tg-button); color: var(--tg-button-text); }
        .progress-bar-fill { background-color: var(--tg-button); }
        .timer-svg { transform: scaleX(-1) rotate(-90deg); }
        .timer-svg-circle { transition: stroke-dashoffset 1s linear; }
        #level-up-toast { transition: opacity 0.5s, transform 0.5s; }
    </style>
</head>
<body class="font-sans antialiased">
    <div id="app" class="max-w-md mx-auto p-4">
        <div id="welcome-container" class="text-center space-y-4">
            <h1 id="welcome-message" class="text-3xl font-bold">Memuat...</h1>
            <div id="user-stats" class="bg-slate-100 dark:bg-slate-800 p-4 rounded-lg hidden">
                <h2 id="level-display" class="text-2xl font-semibold">Level 0</h2>
                <p id="progress-text" class="text-sm" style="color: var(--tg-hint);">Progres: 0/10</p>
                <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5 mt-2">
                    <div id="progress-bar" class="progress-bar-fill h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
            <p id="welcome-info" class="hidden" style="color: var(--tg-hint);">Jawab pertanyaan dengan benar untuk naik level!</p>
            <div class="space-y-3">
                <button id="start-quiz-btn" class="btn-primary w-full py-3 rounded-lg font-semibold text-lg" disabled>Mulai Kuis</button>
                <button id="show-leaderboard-btn" class="bg-slate-200 dark:bg-slate-700 w-full py-3 rounded-lg font-semibold text-lg" disabled>Lihat Leaderboard</button>
            </div>
        </div>
        <div id="quiz-container" class="hidden text-center space-y-4">
            <div class="relative w-24 h-24 mx-auto">
                <svg class="timer-svg" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="none" stroke="#e0e0e0" stroke-width="10"></circle>
                    <circle id="timer-circle" class="timer-svg-circle" cx="50" cy="50" r="45" fill="none" stroke="#22c55e" stroke-width="10" stroke-linecap="round" pathLength="100"></circle>
                </svg>
                <span id="timer-text" class="absolute inset-0 flex items-center justify-center text-2xl font-bold">30</span>
            </div>
            <h2 id="question" class="text-xl font-semibold min-h-[80px]">Memuat soal...</h2>
            <div id="options-container" class="space-y-3"></div>
            <p id="feedback" class="font-bold min-h-[24px]"></p>
            <div class="flex space-x-2 pt-4">
                <button id="home-btn-quiz" class="bg-slate-200 dark:bg-slate-700 w-full py-2 rounded-lg font-semibold">Menu Utama</button>
                <button id="leaderboard-btn-quiz" class="bg-slate-200 dark:bg-slate-700 w-full py-2 rounded-lg font-semibold">Leaderboard</button>
            </div>
        </div>
        <div id="leaderboard-container" class="hidden space-y-4">
            <h2 class="text-2xl font-bold text-center">üèÜ Leaderboard üèÜ</h2>
            <div id="leaderboard-body" class="space-y-2"></div>
            <button id="back-to-menu-btn" class="bg-slate-200 dark:bg-slate-700 w-full py-3 rounded-lg font-semibold">Kembali</button>
        </div>
        <div id="level-up-toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-green-500 text-white py-3 px-6 rounded-full shadow-lg opacity-0 translate-y-10">
            <span id="level-up-text" class="font-bold text-lg"></span>
        </div>
    </div>
    <script>
        const welcomeContainer = document.getElementById('welcome-container'), quizContainer = document.getElementById('quiz-container'), leaderboardContainer = document.getElementById('leaderboard-container'), questionEl = document.getElementById('question'), optionsContainerEl = document.getElementById('options-container'), feedbackEl = document.getElementById('feedback'), levelDisplay = document.getElementById('level-display'), progressText = document.getElementById('progress-text'), progressBar = document.getElementById('progress-bar'), timerCircle = document.getElementById('timer-circle'), timerText = document.getElementById('timer-text'), welcomeMessageEl = document.getElementById('welcome-message'), startQuizBtn = document.getElementById('start-quiz-btn'), showLeaderboardBtn = document.getElementById('show-leaderboard-btn'), userStatsEl = document.getElementById('user-stats'), welcomeInfoEl = document.getElementById('welcome-info');
        let tgUser = null, timerInterval, isInteractionLocked = false, bankSoal = [], soalSekarangIndex = 0, skor = 0, currentQuestionText = "";
        let currentUser = { level: 0, xp: 0, xp_needed: 10 };

        function showPage(page) { [welcomeContainer, quizContainer, leaderboardContainer].forEach(p => p.classList.add('hidden')); page.classList.remove('hidden'); }
        document.getElementById('start-quiz-btn').addEventListener('click', startQuiz);
        document.getElementById('show-leaderboard-btn').addEventListener('click', showLeaderboard);
        document.getElementById('back-to-menu-btn').addEventListener('click', () => showPage(welcomeContainer));
        document.getElementById('home-btn-quiz').addEventListener('click', () => { clearInterval(timerInterval); showPage(welcomeContainer); });
        document.getElementById('leaderboard-btn-quiz').addEventListener('click', () => { clearInterval(timerInterval); showLeaderboard(); });

        function startTimer() { /* ... kode sama ... */ }
        async function startQuiz() { /* ... kode sama ... */ }
        function muatSoal() { /* ... kode sama ... */ }
        function pilihJawaban(soal, jawabanDipilih) { /* ... kode sama ... */ }
        async function submitProgress(xpGained, questionText) { /* ... kode sama ... */ }
        function showLevelUpNotification(newLevel) { /* ... kode sama ... */ }
        async function fetchUserProgress() { /* ... kode sama ... */ }
        function updateProgressUI() { /* ... kode sama ... */ }
        async function showLeaderboard() { /* ... kode sama ... */ }
        document.addEventListener('DOMContentLoaded', async () => {
            const tg = window.Telegram.WebApp;
            tg.ready();
            document.documentElement.style.setProperty('--tg-bg', tg.themeParams.bg_color || '#ffffff');
            document.documentElement.style.setProperty('--tg-text', tg.themeParams.text_color || '#000000');
            document.documentElement.style.setProperty('--tg-button', tg.themeParams.button_color || '#3390ec');
            document.documentElement.style.setProperty('--tg-button-text', tg.themeParams.button_text_color || '#ffffff');
            document.documentElement.style.setProperty('--tg-hint', tg.themeParams.hint_color || '#999999');

            if (tg.initDataUnsafe?.user) {
                tgUser = tg.initDataUnsafe.user;
                welcomeMessageEl.innerText = `Hai, ${tgUser.first_name}!`;
                startQuizBtn.disabled = false;
                showLeaderboardBtn.disabled = false;
                userStatsEl.classList.remove('hidden');
                welcomeInfoEl.classList.remove('hidden');
                await fetchUserProgress();
            } else {
                welcomeMessageEl.innerText = 'Error';
                userStatsEl.classList.remove('hidden');
                levelDisplay.innerText = 'Gagal memuat user';
                progressText.innerText = 'Silakan buka aplikasi dari dalam Telegram.';
            }
        });
    </script>
</body>
    </html>
    
