<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Level Up</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <meta name="monetag" content="456e681fa51bd728d62ad7e576374311">
    
    <style>
        :root {
            --tg-bg: #ffffff; --tg-text: #000000; --tg-button: #3390ec;
            --tg-button-text: #ffffff; --tg-hint: #999999;
        }
        body { background-color: var(--tg-bg); color: var(--tg-text); }
        .btn-primary { background-color: var(--tg-button); color: var(--tg-button-text); }
        .btn-primary:disabled { background-color: #9e9e9e; }
        .progress-bar-fill { background-color: var(--tg-button); }
        .timer-svg { transform: scaleX(-1) rotate(-90deg); }
        .timer-svg-circle { transition: stroke-dashoffset 1s linear; }
        #level-up-toast { transition: opacity 0.5s, transform 0.5s; }

        /* Style untuk Overlay Iklan Interstitial */
        #interstitial-overlay {
            background-color: rgba(0, 0, 0, 0.7);
            transition: opacity 0.3s;
        }

        /* ## KODE BARU UNTUK DEBUGGING ## */
        #interstitial-container > div {
            border: 3px solid red !important;
            background-color: #f0f0f0;
            min-height: 250px; /* Beri tinggi minimal agar terlihat */
            display: flex;
            align-items: center;
            justify-content: center;
            color: black;
            font-family: sans-serif;
            text-align: center;
            padding: 1rem;
        }
    </style>
</head>
<body class="font-sans antialiased">
    <div id="app" class="max-w-md mx-auto p-4 pb-24">

        <div id="welcome-container" class="text-center space-y-4">
            </div>

        <div id="quiz-container" class="hidden text-center space-y-4 relative">
            </div>

        <div id="game-over-container" class="hidden text-center space-y-4 pt-10">
            </div>

        <div id="leaderboard-container" class="hidden space-y-4">
            </div>
        
        <div id="level-up-toast" class="fixed bottom-24 left-1/2 -translate-x-1/2 bg-green-500 text-white py-3 px-6 rounded-full shadow-lg opacity-0 translate-y-10">
            <span id="level-up-text" class="font-bold text-lg"></span>
        </div>
    </div>

    <div id="interstitial-overlay" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div id="interstitial-container" class="relative bg-white dark:bg-slate-800 p-4 rounded-lg max-w-sm w-full">
            <div>Wadah Iklan (Jika kamu melihat ini, berarti wadahnya muncul)</div>

            <button id="close-interstitial-btn" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-8 h-8 font-bold text-lg">&times;</button>
        </div>
    </div>
    
    <script>
        const welcomeContainer = document.getElementById('welcome-container'), quizContainer = document.getElementById('quiz-container'), leaderboardContainer = document.getElementById('leaderboard-container'), gameOverContainer = document.getElementById('game-over-container'), interstitialOverlay = document.getElementById('interstitial-overlay'), closeInterstitialBtn = document.getElementById('close-interstitial-btn');
        // ... (Sisa referensi elemen sama persis seperti sebelumnya)
        
        let tgUser = null, timerInterval, isInteractionLocked = false, bankSoal = [], soalSekarangIndex = 0, skor = 0, currentQuestionText = "", questionAnsweredCount = 0;
        let currentUser = { level: 0, xp: 0, xp_needed: 10, lives: 3 };

        // --- Fungsi Iklan ---
        function triggerInterstitialAd() {
            console.log("Interstitial Ad (Native) Triggered");
            interstitialOverlay.classList.remove('hidden');
        }

        closeInterstitialBtn.addEventListener('click', () => {
            interstitialOverlay.classList.add('hidden');
        });

        function triggerRewardAd() {
            console.log("Reward Ad (Native) Triggered");
            triggerInterstitialAd(); 
            
            const watchAdBtn = document.getElementById('watch-ad-btn');
            
            closeInterstitialBtn.onclick = async () => {
                interstitialOverlay.classList.add('hidden');
                watchAdBtn.disabled = true;
                watchAdBtn.innerText = 'Memproses hadiah...';
                try {
                    const response = await fetch('/api/add_life', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ user: tgUser }) });
                    const data = await response.json();
                    if (data.status === 'success') {
                        currentUser.lives = data.lives;
                        updateLivesUI();
                        showPage(welcomeContainer);
                    } else { throw new Error(data.error); }
                } catch (error) { alert('Gagal mendapatkan nyawa.'); }
                finally { watchAdBtn.disabled = false; watchAdBtn.innerText = 'Tonton Iklan (+1 Nyawa)'; }
                closeInterstitialBtn.onclick = () => interstitialOverlay.classList.add('hidden');
            };
        }

        // ... (Sisa kode JavaScript lainnya tidak perlu diubah)
        // Semua fungsi seperti showPage, startQuiz, muatSoal, pilihJawaban,
        // submitProgress, updateLivesUI, dll., sudah benar.
        // Salin seluruh bagian <script> dari jawaban lengkap terakhir.
    </script>
</body>
</html>
